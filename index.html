<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmpowerHer | Login & Register</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-indigo-50 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white w-full max-w-2xl rounded-3xl shadow-2xl p-8 border border-gray-100">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-black text-indigo-700">EmpowerHer</h1>
            <p id="subtitle" class="text-gray-600 mt-2 font-medium">Join the community of women leaders</p>
        </div>

        <div class="flex bg-gray-100 p-1.5 rounded-2xl mb-8 max-w-sm mx-auto">
            <button id="tab-signin" onclick="toggleView('signin')" class="w-1/2 py-2 text-sm font-bold rounded-xl text-gray-500">Sign In</button>
            <button id="tab-signup" onclick="toggleView('signup')" class="w-1/2 py-2 text-sm font-bold rounded-xl bg-white text-indigo-700 shadow-sm">Sign Up</button>
        </div>

        <form onsubmit="handleAuthSubmit(event)" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="email" id="email" required class="p-3 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Email Address">
                <input type="password" id="password" required class="p-3 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Password">
            </div>

            <div id="signup-extra" class="space-y-4 pt-4 border-t border-gray-100">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="fullname" placeholder="Full Name" class="p-3 bg-gray-50 border border-gray-200 rounded-xl outline-none">
                    <input type="tel" id="phone" placeholder="Phone Number" class="p-3 bg-gray-50 border border-gray-200 rounded-xl outline-none">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="date" id="dob" class="p-3 bg-gray-50 border border-gray-200 rounded-xl outline-none">
                    <input type="text" id="education" placeholder="Education (e.g. B.Tech)" class="p-3 bg-gray-50 border border-gray-200 rounded-xl outline-none">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="number" id="passout" placeholder="Passing Year" class="p-3 bg-gray-50 border border-gray-200 rounded-xl outline-none">
                    <input type="text" id="marks" placeholder="Marks (%)" class="p-3 bg-gray-50 border border-gray-200 rounded-xl outline-none">
                </div>
            </div>

            <button type="submit" id="submit-btn" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold hover:bg-indigo-700 transition transform active:scale-95 shadow-lg shadow-indigo-100">
                Create Account
            </button>
        </form>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBgOgOrtS6P-oJj39UxOP5QjolPqc0cMJk",
            authDomain: "myka-tech.firebaseapp.com",
            projectId: "myka-tech",
            storageBucket: "myka-tech.firebasestorage.app",
            messagingSenderId: "922086084506",
            appId: "1:922086084506:web:349fd90c68096ed7397423",
            measurementId: "G-0WZGJ1SXE5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let isSignUp = true;

        window.toggleView = function(mode) {
            isSignUp = (mode === 'signup');
            const extra = document.getElementById('signup-extra');
            const submitBtn = document.getElementById('submit-btn');
            const tabIn = document.getElementById('tab-signin');
            const tabUp = document.getElementById('tab-signup');

            if (mode === 'signin') {
                extra.style.display = 'none';
                submitBtn.innerText = "Sign In";
                tabIn.className = "w-1/2 py-2 text-sm font-bold rounded-xl bg-white text-indigo-700 shadow-sm";
                tabUp.className = "w-1/2 py-2 text-sm font-bold rounded-xl text-gray-500";
            } else {
                extra.style.display = 'block';
                submitBtn.innerText = "Create Account";
                tabUp.className = "w-1/2 py-2 text-sm font-bold rounded-xl bg-white text-indigo-700 shadow-sm";
                tabIn.className = "w-1/2 py-2 text-sm font-bold rounded-xl text-gray-500";
            }
        };

        window.handleAuthSubmit = async function(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;

            if (isSignUp) {
                const userData = {
                    email: email,
                    name: document.getElementById('fullname').value || "Student User",
                    phone: document.getElementById('phone').value || "Not Set",
                    dob: document.getElementById('dob').value || "Not Set",
                    education: document.getElementById('education').value || "Not Set",
                    passYear: document.getElementById('passout').value || "Not Set",
                    marks: document.getElementById('marks').value || "Not Set",
                    createdAt: new Date().toISOString()
                };

                try {
                    await setDoc(doc(db, "users", email), userData);
                    localStorage.setItem('userEmail', email);
                    localStorage.setItem('isLoggedIn', 'true');
                    alert("Account Created Successfully!");
                    window.location.href = 'dashboard.html';
                } catch (error) {
                    console.error("Error saving data:", error);
                    alert("Error: " + error.message);
                }
            } else {
                try {
                    const docRef = doc(db, "users", email);
                    const docSnap = await getDoc(docRef);

                    if (docSnap.exists()) {
                        localStorage.setItem('userEmail', email);
                        localStorage.setItem('isLoggedIn', 'true');
                        window.location.href = 'dashboard.html';
                    } else {
                        alert("No account found with this email. Please Sign Up.");
                    }
                } catch (error) {
                    alert("Login Error: " + error.message);
                }
            }
        };
    </script>
</body>
</html>